<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Diagn√≥stico - DeepAlias Hunter Pro</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --primary-dark: #1a252f;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --background-color: #ecf0f1;
            --card-background: #ffffff;
            --text-color: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #bdc3c7;
            --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: var(--card-background);
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: var(--primary-color);
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
        }

        .section h3 {
            color: var(--secondary-color);
            font-size: 1.4em;
            margin: 20px 0 10px 0;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #b8daff;
        }

        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .steps {
            counter-reset: step-counter;
        }

        .step {
            counter-increment: step-counter;
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-left: 4px solid var(--secondary-color);
            border-radius: 0 4px 4px 0;
        }

        .step::before {
            content: "Passo " counter(step-counter) ": ";
            font-weight: bold;
            color: var(--secondary-color);
        }

        .checklist {
            list-style: none;
        }

        .checklist li {
            margin: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        .checklist li::before {
            content: "‚úÖ";
            position: absolute;
            left: 0;
            top: 0;
        }

        .problem-list {
            list-style: none;
        }

        .problem-list li {
            margin: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        .problem-list li::before {
            content: "‚ùå";
            position: absolute;
            left: 0;
            top: 0;
        }

        .diagnostic-button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }

        .diagnostic-button:hover {
            background-color: #2980b9;
        }

        .diagnostic-button.success {
            background-color: var(--success-color);
        }

        .diagnostic-button.warning {
            background-color: var(--warning-color);
        }

        .diagnostic-button.danger {
            background-color: var(--danger-color);
        }

        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .result.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Guia de Diagn√≥stico</h1>
            <p>DeepAlias Hunter Pro - Firefox Edition</p>
        </div>

        <div class="content">
            <div class="section">
                <div class="alert alert-danger">
                    <strong>‚ùå PROBLEMA IDENTIFICADO:</strong><br>
                    A extens√£o DeepAlias Hunter Pro est√° apresentando erros de comunica√ß√£o entre popup e background script no Firefox:
                    <div class="problem-list">
                        <li>"Timeout na comunica√ß√£o com background script"</li>
                        <li>"storageService.remove is not a function"</li>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üîç Diagn√≥stico Realizado</h2>
                
                <h3>‚úÖ Verifica√ß√µes Conclu√≠das:</h3>
                <ul class="checklist">
                    <li><strong>Background Script:</strong> C√≥digo analisado e est√° correto</li>
                    <li><strong>Message Handlers:</strong> Todas as fun√ß√µes est√£o implementadas</li>
                    <li><strong>Storage Service:</strong> Fun√ß√£o remove() existe e est√° funcionando</li>
                    <li><strong>Polyfill:</strong> Compatibilidade Firefox/Chrome implementada</li>
                    <li><strong>Sintaxe:</strong> Nenhum erro de sintaxe encontrado</li>
                    <li><strong>Manifesto:</strong> Configura√ß√£o correta para Firefox</li>
                </ul>

                <div class="alert alert-warning">
                    <strong>üö® PROBLEMA IDENTIFICADO:</strong><br>
                    O background script parece n√£o estar sendo carregado ou inicializado corretamente no Firefox.
                </div>
            </div>

            <div class="section">
                <h2>üìã Instru√ß√µes para Teste Manual</h2>
                
                <div class="steps">
                    <div class="step">
                        <strong>Prepara√ß√£o do Firefox</strong>
                        <div class="code-block">
1. Abrir Firefox<br>
2. Navegar para: about:debugging<br>
3. Clicar em "Este Firefox"<br>
4. Clicar em "Carregar extens√£o tempor√°ria"<br>
5. Selecionar o arquivo: manifest_firefox.json
                        </div>
                    </div>

                    <div class="step">
                        <strong>Verifica√ß√£o de Carregamento</strong>
                        <div class="code-block">
Ap√≥s carregar a extens√£o:<br>
1. Pressionar F12 para abrir as ferramentas de desenvolvedor<br>
2. Ir para a aba "Console"<br>
3. Procurar por mensagens de:<br>
   - [INIT] Background script iniciando...<br>
   - [INIT] ‚úÖ Initialize conclu√≠do com sucesso!<br>
   - Ou erros de carregamento
                        </div>
                    </div>

                    <div class="step">
                        <strong>Teste de Comunica√ß√£o B√°sica</strong>
                        <div class="code-block">
// Cole este c√≥digo no console do Firefox:<br>
(async () => {<br>
    try {<br>
        const response = await browser.runtime.sendMessage({ type: 'ping' });<br>
        console.log('‚úÖ SUCESSO:', response);<br>
    } catch (error) {<br>
        console.error('‚ùå ERRO:', error);<br>
    }<br>
})();
                        </div>
                    </div>
                </div>
            </div>            <div class="section">
                <h2>üõ†Ô∏è Ferramentas de Diagn√≥stico R√°pido</h2>
                <p>Use os bot√µes abaixo para executar testes r√°pidos:</p>
                
                <button id="test-ping-btn" class="diagnostic-button">üèì Testar Ping</button>
                <button id="test-storage-btn" class="diagnostic-button warning">üíæ Testar Storage</button>
                <button id="test-info-btn" class="diagnostic-button success">‚ÑπÔ∏è Info do Background</button>
                <button id="open-debug-btn" class="diagnostic-button danger">üîç Debug Interno</button>
                
                <div id="ping-result" class="result"></div>
                <div id="storage-result" class="result"></div>
                <div id="info-result" class="result"></div>
            </div>

            <div class="section">
                <h2>üéØ Solu√ß√µes Recomendadas</h2>
                
                <div class="alert alert-info">
                    <strong>üí° SOLU√á√ÉO PRINCIPAL:</strong><br>
                    Use a <strong>Ferramenta de Debug Interno</strong> que roda dentro do contexto da extens√£o e tem acesso completo √†s APIs do browser.
                </div>

                <div class="steps">
                    <div class="step">
                        <strong>Acesso pela P√°gina de Op√ß√µes</strong><br>
                        1. Clique no √≠cone da extens√£o<br>
                        2. Selecione "Configura√ß√µes"<br>
                        3. Role at√© "Ferramentas de Desenvolvimento"<br>
                        4. Clique em "üîç Abrir Ferramenta de Debug Interno"
                    </div>

                    <div class="step">
                        <strong>Acesso Direto</strong><br>
                        <div class="code-block">
URL: moz-extension://[ID-DA-EXTENSAO]/src/debug/debug_interno.html
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìû Suporte T√©cnico</h2>
                <p>Se os problemas persistirem ap√≥s seguir este guia:</p>
                <ul>
                    <li>Verifique se est√° usando a vers√£o mais recente da extens√£o</li>
                    <li>Teste em uma nova sess√£o do Firefox (modo privado)</li>
                    <li>Verifique se n√£o h√° conflitos com outras extens√µes</li>
                    <li>Consulte os logs detalhados na ferramenta de debug interno</li>
                </ul>
            </div>
        </div>

        <div class="footer">
            <p>DeepAlias Hunter Pro v4.0.0 - Guia de Diagn√≥stico T√©cnico</p>
        </div>
    </div>    <script>
        // Polyfill para compatibilidade
        const browserAPI = typeof browser !== 'undefined' ? browser : chrome;

        // Inicializar event listeners quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar event listeners
            document.getElementById('test-ping-btn').addEventListener('click', testPing);
            document.getElementById('test-storage-btn').addEventListener('click', testStorage);
            document.getElementById('test-info-btn').addEventListener('click', testBackgroundInfo);
            document.getElementById('open-debug-btn').addEventListener('click', openDebugInternal);
        });

        async function testPing() {
            const resultDiv = document.getElementById('ping-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Testando comunica√ß√£o...';

            try {
                const response = await browserAPI.runtime.sendMessage({ type: 'ping' });
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `<strong>‚úÖ SUCESSO!</strong><br>Resposta: ${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå ERRO:</strong><br>${error.message}`;
            }
        }

        async function testStorage() {
            const resultDiv = document.getElementById('storage-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Testando storage...';

            try {
                const response = await browserAPI.runtime.sendMessage({ 
                    type: 'storage-test',
                    key: 'test-key',
                    value: 'test-value'
                });
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `<strong>‚úÖ SUCESSO!</strong><br>Storage funcionando: ${JSON.stringify(response, null, 2)}`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå ERRO:</strong><br>${error.message}`;
            }
        }

        async function testBackgroundInfo() {
            const resultDiv = document.getElementById('info-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultDiv.textContent = 'Obtendo informa√ß√µes...';

            try {
                const response = await browserAPI.runtime.sendMessage({ type: 'debug-info' });
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `<strong>‚ÑπÔ∏è INFORMA√á√ïES:</strong><br><pre>${JSON.stringify(response, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `<strong>‚ùå ERRO:</strong><br>${error.message}`;
            }
        }

        function openDebugInternal() {
            try {
                const debugUrl = browserAPI.runtime.getURL('src/debug/debug_interno.html');
                browserAPI.tabs.create({ url: debugUrl, active: true });
            } catch (error) {
                alert('Erro ao abrir debug interno: ' + error.message);
            }
        }
    </script>
</body>
</html>
