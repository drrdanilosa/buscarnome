<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifica√ß√£o Final - DeepAlias Hunter Pro (Firefox)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .success {
            border-left: 5px solid #2ecc71;
        }
        .warning {
            border-left: 5px solid #f39c12;
        }
        .error {
            border-left: 5px solid #e74c3c;
        }
        pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        code {
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            color: #16a085;
        }
        ul {
            padding-left: 20px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 10px 0;
        }
        button:hover {
            background: #2980b9;
        }
        .log {
            height: 200px;
            overflow-y: auto;
            background: #f0f0f0;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #ddd;
            margin-top: 10px;
        }
        .timestamp {
            color: #7f8c8d;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <h1>Verifica√ß√£o Final - DeepAlias Hunter Pro (Firefox)</h1>
    <p>Esta p√°gina verifica se todas as corre√ß√µes aplicadas para resolver o problema de timeout no Firefox est√£o funcionando corretamente.</p>
    
    <div class="card success">
        <h2>‚úÖ Status das Corre√ß√µes</h2>
        <p>Todas as corre√ß√µes foram aplicadas com sucesso para resolver os seguintes problemas:</p>
        <ul>
            <li>Duplica√ß√£o da fun√ß√£o <code>handleMessage</code> corrigida</li>
            <li>Timeout aumentado de 5 para 15 segundos</li>
            <li>Manipuladores de mensagens implementados corretamente</li>
            <li>Tratamento espec√≠fico para Firefox implementado</li>
            <li>Ferramenta de diagn√≥stico aprimorada</li>
        </ul>
    </div>
    
    <div class="card">
        <h2>üìã Resumo das Mudan√ßas</h2>
        <ul>
            <li><strong>background_simple.js</strong>: Corre√ß√£o do manipulador de mensagens e implementa√ß√£o dos servi√ßos faltantes</li>
            <li><strong>popup.js</strong>: Melhoria na comunica√ß√£o com o background script e ajuste do timeout</li>
        </ul>
    </div>
    
    <div class="card">
        <h2>üîç Teste de Comunica√ß√£o</h2>
        <p>Clique no bot√£o abaixo para testar a comunica√ß√£o com o background script:</p>
        <button id="test-ping">Testar Ping (5s)</button>
        <button id="test-platforms">Verificar Plataformas (10s)</button>
        <div id="test-results" class="log"></div>
    </div>
    
    <div class="card">
        <h2>üîß Como Verificar Manualmente</h2>
        <ol>
            <li>Abra a extens√£o no Firefox</li>
            <li>Clique no bot√£o "ü¶ä Diagn√≥stico Firefox" no rodap√© da extens√£o</li>
            <li>Verifique se todos os servi√ßos est√£o funcionando corretamente</li>
            <li>Realize uma busca normal para verificar o funcionamento completo</li>
        </ol>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const resultLog = document.getElementById('test-results');
        const pingButton = document.getElementById('test-ping');
        const platformsButton = document.getElementById('test-platforms');
        
        function log(message, type = 'info') {
            const colors = {
                success: '#2ecc71',
                error: '#e74c3c',
                warning: '#f39c12',
                info: '#3498db'
            };
            
            const logEntry = document.createElement('div');
            logEntry.style.borderLeft = `3px solid ${colors[type]}`;
            logEntry.style.padding = '5px';
            logEntry.style.marginBottom = '5px';
            
            const timestamp = document.createElement('span');
            timestamp.className = 'timestamp';
            timestamp.textContent = new Date().toLocaleTimeString() + ' - ';
            
            const content = document.createElement('span');
            content.textContent = message;
            
            logEntry.appendChild(timestamp);
            logEntry.appendChild(content);
            resultLog.appendChild(logEntry);
            resultLog.scrollTop = resultLog.scrollHeight;
        }
        
        pingButton.addEventListener('click', async () => {
            log('Testando comunica√ß√£o com background script (timeout: 5s)...', 'info');
            
            try {
                const browserAPI = typeof browser !== 'undefined' ? browser : chrome;
                if (!browserAPI || !browserAPI.runtime) {
                    throw new Error('API de navegador n√£o dispon√≠vel');
                }
                
                const startTime = performance.now();
                
                // Testar comunica√ß√£o com o background script
                const response = await Promise.race([
                    browserAPI.runtime.sendMessage({
                        type: 'ping',
                        ping: 'PING',
                        timestamp: Date.now()
                    }),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Timeout na comunica√ß√£o (5s)')), 5000)
                    )
                ]);
                
                const responseTime = Math.round(performance.now() - startTime);
                
                if (response && response.success) {
                    log(`‚úÖ Resposta recebida em ${responseTime}ms!`, 'success');
                    log(`Browser: ${response.browser || 'Desconhecido'}`, 'info');
                    log(`Vers√£o: ${response.version || 'Desconhecida'}`, 'info');
                    log(`Plataformas: ${response.platformCount || 0}`, 'info');
                    log(`Servi√ßos: ${response.servicesInitialized ? 'Inicializados' : 'Com problemas'}`, 'info');
                } else {
                    log(`‚ö†Ô∏è Resposta sem formato esperado: ${JSON.stringify(response)}`, 'warning');
                }
            } catch (error) {
                log(`‚ùå Erro na comunica√ß√£o: ${error.message}`, 'error');
                log('Recomenda√ß√£o: Verifique se a extens√£o est√° instalada e ativa', 'warning');
            }
        });
        
        platformsButton.addEventListener('click', async () => {
            log('Verificando plataformas dispon√≠veis (timeout: 10s)...', 'info');
            
            try {
                const browserAPI = typeof browser !== 'undefined' ? browser : chrome;
                if (!browserAPI || !browserAPI.runtime) {
                    throw new Error('API de navegador n√£o dispon√≠vel');
                }
                
                const startTime = performance.now();
                
                // Testar acesso √†s plataformas
                const response = await Promise.race([
                    browserAPI.runtime.sendMessage({
                        type: 'getPlatforms'
                    }),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Timeout na comunica√ß√£o (10s)')), 10000)
                    )
                ]);
                
                const responseTime = Math.round(performance.now() - startTime);
                
                if (response && response.success && response.platforms) {
                    const platformCount = response.platforms.length;
                    log(`‚úÖ ${platformCount} plataformas encontradas em ${responseTime}ms!`, 'success');
                    
                    // Mostrar categorias das plataformas
                    const categories = [...new Set(response.platforms.map(p => p.category))];
                    log(`üìÇ Categorias: ${categories.join(', ')}`, 'info');
                    
                    // Mostrar exemplos de plataformas
                    const examples = response.platforms.slice(0, 5).map(p => p.name).join(', ');
                    log(`üìã Exemplos: ${examples}`, 'info');
                    
                    // Verificar plataformas adultas
                    const adultCount = response.platforms.filter(p => p.adult === true).length;
                    log(`üîû Plataformas adultas: ${adultCount}`, 'info');
                } else {
                    log(`‚ö†Ô∏è Resposta inv√°lida: ${JSON.stringify(response)}`, 'warning');
                }
            } catch (error) {
                log(`‚ùå Erro na comunica√ß√£o: ${error.message}`, 'error');
                log('Recomenda√ß√£o: Verifique se a extens√£o est√° instalada e ativa', 'warning');
            }
        });
        
        log('P√°gina de verifica√ß√£o final carregada', 'info');
        log('Clique nos bot√µes acima para testar a comunica√ß√£o com a extens√£o', 'info');
    });
    </script>
</body>
</html>
